{% extends "base.html" %}

{% block title %}Projects - Secret Santa Matching{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <h1 class="text-center mb-4 text-white text-decoration-underline">Secret Santa Matching</h1>

            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Project Overview</h5>
                    <p class="card-text">
                        I developed a Secret Santa partner-matching program in Python that ensures no one selects
                        themselves and provides a private interface for users to view their match. This streamlined the
                        process for holiday gift exchanges while maintaining confidentiality.
                    </p>
                </div>
            </div>

            <!-- Case Study CTA -->
            <div class="alert alert-info case-study-cta mb-4">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h5 class="mb-2"><i class="fas fa-book-open"></i> Want the full story?</h5>
                        <p class="mb-0">Read the complete case study to learn about the derangement algorithm, constraint solving, and lessons learned.</p>
                    </div>
                    <a href="{{ url_for('secret_santa_case_study') }}" class="btn btn-primary ms-3">
                        Read Case Study <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">How It Works</h5>
                    <p class="card-text">
                        The program takes a list of participants and randomly assigns each person a Secret Santa, with
                        the rule that no one can be assigned to themselves.
                    </p>
                    <div class="text-center">
                        <pre class="mermaid">
                            graph TD;
                                A[Enter Participant Names] --> B{Generate Matches};
                                B --> C{Ensure No Self-Matching};
                                C --> D{Display Private Interface};
                                D --> E[View Your Match];
                        </pre>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Interactive Matching Tool</h5>
                    <div class="secret-santa-container">
                        <section class="secret-santa-form-section">
                            <!-- Error message placeholder (server-side or client-side) -->
                            <div id="error-message" class="alert alert-error" role="alert" style="display: none;">
                                <span class="alert-icon">⚠️</span>
                                <div class="alert-content">
                                    <strong>Error:</strong> <span id="error-text"></span>
                                </div>
                            </div>

                            <!-- Success message placeholder (client-side) -->
                            <div id="success-message" class="alert alert-success" role="alert" style="display: none;">
                                <span class="alert-icon">✅</span>
                                <div class="alert-content">
                                    <strong>Success!</strong> Secret Santa matches have been generated! Select your name below to see your match.
                                </div>
                            </div>

                            <!-- Show server-side error if present -->
                            {% if error %}
                            <script>
                                document.addEventListener('DOMContentLoaded', function() {
                                    const errorDiv = document.getElementById('error-message');
                                    const errorText = document.getElementById('error-text');
                                    if (errorDiv && errorText) {
                                        errorText.textContent = {{ error | tojson }};
                                        errorDiv.style.display = 'flex';
                                    }
                                });
                            </script>
                            {% endif %}

                            <form id="names-form" class="secret-santa-form" method="POST">
                                <div class="form-group">
                                    <label for="names">Enter Names (comma separated):</label>
                                    <input type="text" id="names" name="names"
                                        value="{{ names|join(', ') if names else '' }}"
                                        placeholder="e.g., John, Mary, Bob, Alice" required
                                        pattern="^[A-Za-z\s]+(,[A-Za-z\s]+)*$"
                                        title="Please enter names separated by commas" class="secret-santa-input">
                                </div>
                                <button type="submit" class="btn-generate">Generate Secret Santa</button>
                            </form>
                        </section>
                        <div class="match-result" id="matchResult" style="display: none;">
                            <h3>Your Secret Santa Match</h3>
                            <p id="matchResultText"></p>
                        </div>
                    </div>
                </div>
            </div>

            <section class="match-section card mb-4" id="matchSection" style="display: none;">
                <div class="card-body">
                    <h5 class="card-title">Find Your Secret Santa Match</h5>
                    <form id="match-form" class="secret-santa-form">
                        <div class="form-group">
                            <label for="person">Select your name:</label>
                            <select name="person" id="person" class="secret-santa-select">
                                <option value="">Choose your name</option>
                            </select>
                        </div>


                        <div class="button-group">
                            <button type="button" class="btn-hide-match" id="hideResults">Hide Results</button>
                            {% if names %}
                            <form id="reset-form" class="reset-form" style="display: none;">
                                <button type="button" class="btn-clear" id="clearListButton"
                                    onclick="return confirm('Are you sure you want to clear all matches?')">
                                    Clear List
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </form>
                </div>
            </section>

            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Technologies Used</h5>
                    <ul>
                        <li><strong>Python:</strong> For the matching algorithm.</li>
                        <li><strong>Problem Solving:</strong> To ensure fair and random assignments.</li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block mermaid_js %}
<!-- Mermaid.js for Secret Santa flow diagram -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        mermaid.initialize({ startOnLoad: true });
    });
</script>
{% endblock %}

{% block scripts %}
{{ super() }}
<!-- Pass Jinja2 template data to JavaScript -->
<script>
    window.secretSantaInitialNames = {{ names | tojson }} || [];
    window.secretSantaInitialResults = {{ results | tojson }} || {};
</script>
<!-- Secret Santa logic -->
<script src="{{ url_for('static', filename='js/secret-santa.js') }}?v={{ now.timestamp() }}"></script>
{% endblock %}
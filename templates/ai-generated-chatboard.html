{% extends "base.html" %}

{% block title %}AI Innovations - Chat Board{% endblock %}

{% block content %}
<div class="flex justify-center mt-10">
  <div class="w-full max-w-md rounded-2xl shadow-lg p-6 border border-grey-700" style="background-color: rgba(251, 251, 251, 0.5);">
    <h2 class="text-2xl font-bold text-white mb-4 text-center">ðŸ’¬ Realtime Chat</h2>

    <!-- Messages -->
    <div id="messages" class="h-64 overflow-y-auto bg-gray-900 rounded-lg p-3 space-y-2 mb-4 text-gray-100">
      <!-- Messages will appear here -->
    </div>

    <!-- Input Box -->
    <div class="flex space-x-2">
      <input 
        id="message" 
        type="text" 
        autocomplete="off" 
        placeholder="Type your message..." 
        class="flex-1 px-4 py-2 rounded-lg bg-white text-black focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <button 
        onclick="sendMessage()" 
        class="px-4 py-2 bg-blue-600 text-black rounded-lg hover:bg-blue-500 transition"
      >
        Send
      </button>
    </div>
  </div>
</div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
  const messagesContainer = document.getElementById("messages");
  const displayedMessageTimestamps = new Set();

  // Add a message to the chat
  function addMessage(data) {
    if (displayedMessageTimestamps.has(data.timestamp)) return;
    displayedMessageTimestamps.add(data.timestamp);

    const bubble = document.createElement("div");
    const dateObj = new Date(data.timestamp);
    const date = dateObj.toLocaleDateString([], { year: 'numeric', month: 'short', day: 'numeric' });
    const time = dateObj.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const formatted = `${date} ${time}`;

    bubble.className = "bg-gray-700 text-white px-3 py-2 rounded-lg shadow-md animate-fadeIn";
    bubble.textContent = `[${formatted}] ${data.text}`;

    messagesContainer.appendChild(bubble);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }

  const socket = io();

  socket.on("message", addMessage);

  socket.on("connect", () => {
    console.log("Connected to server, waiting for recent messages...");
  });

  // Expose sendMessage to global scope so onclick works
  window.sendMessage = function() {
    const input = document.getElementById("message");
    if (input.value.trim() !== "") {
      const msg = { text: input.value, timestamp: Date.now() };
      socket.send(msg);
      input.value = "";
    }
  };
</script>



<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fadeIn {
    animation: fadeIn 0.2s ease-in-out;
  }
</style>
{% endblock %}
